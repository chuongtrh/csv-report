#!/usr/bin/env node

var cli = require('../lib/cli'),
	path = require('path'),
	optimist = require('optimist'),
	moment = require('moment'),
	argv = optimist
		.usage('Usage: $0 --file <path> [--delim <string>] [--start <string>] [--end <string>] [--round <int>] [--template <path>] [--lang <string>] [--verbose] [--quiet]')
		.options('f', {
			alias: 'file',
			demand: true,
			describe: 'Input .csv file'
		})
		.options('o', {
			alias: 'out',
			demand: true,
			default: path.resolve(__dirname, '../report-' + moment().subtract('month', 1).format('MMM-YY') + '.pdf'),
			describe: 'Output .pdf file'
		})
		.options('d', {
			alias: 'delim',
			default: ';',
			describe: 'The delimeter used in the .csv file'
		})
		.options('s', {
			alias: 'start',
			default: moment().subtract('month', 1).startOf('month').format('YYYY-MM-DD'),
			describe: 'Start of report period'
		})
		.options('e', {
			alias: 'end',
			default: moment().subtract('month', 1).endOf('month').format('YYYY-MM-DD'),
			describe: 'End of report period'
		})
		.options('r', {
			alias: 'round',
			default: 15,
			describe: 'Minutes to round up to. e.g. 21m -> 30m'
		})
		.options('t', {
			alias: 'template',
			default: path.resolve(__dirname, '../lib/template.html'),
			describe: 'Folder where to look for doT.js template'
		})
		.options('l', {
			alias: 'lang',
			default: 'en',
			describe: 'Language setting'
		})
		.options('v', {
			alias: 'verbose',
			boolean: true,
			describe: 'Output all logs'
		})
		.options('q', {
			alias: 'quiet',

			boolean: true,
			describe: 'Dont use interactive mode to start conversion'
		})
		.options('h', {
			alias: 'help',
			describe: 'Show help'
		})
		.argv;
if (argv.h) {
	optimist.showHelp();
}else if(argv.quiet){
	cli.quiet(argv);
}else{
	cli.interactive(argv);
}